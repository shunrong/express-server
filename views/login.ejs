<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script>
      // 请求拦截器
      axios.interceptors.request.use(function (request) {
        const token = localStorage.getItem('token')
        console.log('reqqqqq', request, token)
        request.headers.Authorization =  token
          return request;
        }, function (error) {
          return Promise.reject(error);
        });

      // 返回拦截器
      axios.interceptors.response.use(function (response) {
        console.log('ressss', response)
        const { authorization } = response.headers
        authorization && localStorage.setItem('token', authorization )
          return response;
        }, function (error) {
          return Promise.reject(error);
        });
    </script>
  </head>
  <style>
    section {
      margin: 30px auto;
      width: 300px;
    }
    label {
      display: inline-block;
      width: 80px;
      text-align: right;
    }
    input {
      display: inline-block;
      margin-top: 12px;
      margin-bottom: 12px;
    }
  </style>
  <body>
    <h1><%= title %></h1>
    <p>欢迎来到 <%= title %></p>

    <section>
      <div >
        <label>用户名</label>
        <input id="name"/>
      </div>
      <div>
        <label>密码</label>
        <input type="password" id="password"/>
      </div>
      <div style="text-align: center;">
        <button id="login">登录</button>
      </div>
    </section>



    <script type="text/javascript">
      const nameDom = document.querySelector('#name')
      const passwordDom = document.querySelector('#password')
      const loginBtn = document.querySelector('#login')

      loginBtn.onclick = function() {
        const params = {
          name: nameDom.value,
          password: passwordDom.value,
        }
        axios.post('http://localhost:3000/api/login', params)
        .then(({data}) => {
          console.log(data)
          if(data.ok === 1) {
            location.href = '/'
          } else {
            alert('用户名密码错误')
          }
        })
      }
    </script>
  </body>
</html>
